<!-- Full index.html with video blur TikTok-like feed and complete JS/HTML -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Experiment – Sociální sítě</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 0;
  text-align: center;
}
.hidden {
  display: none;
}
.container {
  max-width: 700px;
  margin: 20px auto;
  padding: 20px;
  background: white;
  border-radius: 12px;
}
button {
  padding: 12px 24px;
  font-size: 18px;
  border-radius: 12px;
  background: #4c8bf5;
  border: none;
  color: white;
  cursor: pointer;
}
button:hover {
  opacity: 0.9;
}
.video-wrapper {
  position: relative;
  width: 100%;
  height: 70vh;
  overflow: hidden;
  margin-bottom: 25px;
  border-radius: 18px;
  background: black;
}
.video-blur {
  position: absolute;
  width: 120%;
  height: 120%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  object-fit: cover;
  filter: blur(25px) brightness(0.7);
  z-index: 1;
}
.video-main {
  position: relative;
  width: 100%;
  height: 100%;
  object-fit: contain;
  z-index: 2;
}
</style>
</head>
<body>

<!-- ÚVODNÍ OBRAZOVKA -->
<div id="screen-intro" class="container">
  <h2>Experimentální část výzkumu</h2>
  <p>Děkujeme za účast. Po kliknutí na tlačítko budete náhodně zařazeni do jedné ze dvou skupin.</p>
  <button onclick="startExperiment()">Začít</button>
</div>

<!-- EXPOZICE -->
<div id="screen-exposure" class="container hidden">
  <h3 id="exposure-description">Načítám…</h3>
  <p>Zbývající čas: <span id="exposure-timer">120</span> sekund</p>

  <div id="exp-feed" class="feed-container hidden"
       style="height: 90vh; overflow-y: scroll; background:#000; border-radius:18px; padding:0; margin-top:20px;">

    <div class="video-wrapper">
      <video class="video-blur" src="short2.mp4" muted playsinline></video>
      <video class="video-main" src="short2.mp4" muted playsinline autoplay></video>
    </div>

    <div class="video-wrapper">
      <video class="video-blur" src="short3.mp4" muted playsinline></video>
      <video class="video-main" src="short3.mp4" muted playsinline autoplay></video>
    </div>

    <div class="video-wrapper">
      <video class="video-blur" src="short4.mp4" muted playsinline></video>
      <video class="video-main" src="short4.mp4" muted playsinline autoplay></video>
    </div>

    <div class="video-wrapper">
      <video class="video-blur" src="short5.mp4" muted playsinline></video>
      <video class="video-main" src="short5.mp4" muted playsinline autoplay></video>
    </div>

    <div class="video-wrapper">
      <video class="video-blur" src="short6.mp4" muted playsinline></video>
      <video class="video-main" src="short6.mp4" muted playsinline autoplay></video>
    </div>

  </div>

  <div id="ctrl-text" class="hidden" style="text-align:left; padding:20px; background:white; border-radius:12px; margin-top:20px;">
    <h3>Neutrální text</h3>
    <p>
      Toto je neutrální text určený pro kontrolní skupinu. Prosím čtěte jej po dobu dvou minut.
      Jeho účelem je nezpůsobovat žádné emoční reakce ani zvýšenou pozornost. Tento text slouží pouze jako
      kontrolní prvek pro porovnání výsledků experimentální skupiny.
    </p>
  </div>
</div>

<!-- LATENCE -->
<div id="screen-latency" class="container hidden">
  <h3>Klikněte na tlačítko pro zahájení úkolu</h3>
  <button onclick="startTask()">Začít úkol</button>
</div>

<!-- ÚKOL -->
<div id="screen-task" class="container hidden">
  <h3>Úkol</h3>
  <p>Zbývající čas: <span id="task-timer">180</span> sekund</p>
  <div id="task-content" style="margin-top:20px;"></div>
  <button onclick="submitAnswer()">Odeslat odpověď</button>
</div>

<!-- KONEC -->
<div id="screen-end" class="container hidden">
  <h3>Děkujeme za účast</h3>
  <p>Kód respondenta: <b id="code-box"></b></p>
  <p>Skupina: <span id="summary-group"></span></p>
  <p>Latence: <span id="summary-latency"></span> s</p>
  <p>Počet správných odpovědí: <span id="summary-score"></span></p>
  <a id="post-form" href="#" target="_blank">
    <button>Pokračovat</button>
  </a>
</div>

<script>
// ----------------------------------------------------------
// VIDEO BLUR FEED – TikTok style
// ----------------------------------------------------------
document.addEventListener("DOMContentLoaded", () => {
  const videos = document.querySelectorAll("#exp-feed .video-main");

  function pauseAll() {
    videos.forEach(v => v.pause());
  }

  // Autoplay prvního videa
  if (videos.length > 0) {
    videos[0].play().catch(() => {});
  }

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        pauseAll();
        entry.target.play();
      }
    });
  }, { threshold: 0.6 });

  videos.forEach(video => observer.observe(video));

  videos.forEach((video, index) => {
    video.addEventListener("ended", () => {
      const next = videos[index + 1];
      if (next) {
        next.scrollIntoView({ behavior: "smooth", block: "center" });
        setTimeout(() => {
          pauseAll();
          next.play();
        }, 600);
      }
    });
  });
});

// ----------------------------------------------------------
//   KONFIGURACE EXPERIMENTU
// ----------------------------------------------------------
const POST_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdYYYYYYYYYYYY/viewform";
const SHEET_URL = "https://script.google.com/macros/s/AKfycbyyadGtr2NtJLlR3PEDPlBwwm2052wT11x4d-tojtDQMW66k704tk_RSdA51-1nfmv_/exec";

const EXPOSURE_SECONDS = 120;
const TASK_SECONDS = 180;

const TASKS = [
  { text: "V obchodě mají balení tužek po 4 kusech. Jana koupila 3 balení. Kolik tužek koupila?", correct: 12 },
  { text: "V krabici je 15 jablek, 4 se zkazí. Kolik jablek zbude?", correct: 11 },
  { text: "Tomáš běžel 20 min a pak šel 15 min. Jak dlouho byl na cestě?", correct: 35 },
  { text: "26 žáků + 18 žáků = ?", correct: 44 },
  { text: "6 lahví v balení × 7 balení = ?", correct: 42 }
];

let group = null;
let exposureRemaining = EXPOSURE_SECONDS;
let taskRemaining = TASK_SECONDS;
let latencyStart = null;
let latencyMs = null;
let currentTask = 0;
let correctCount = 0;
let participantID = null;

function show(id) {
  ["screen-intro","screen-exposure","screen-latency","screen-task","screen-end"]
    .forEach(s => document.getElementById(s).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function startExperiment() {
  group = Math.random() < 0.5 ? "exp" : "ctrl";
  show("screen-exposure");

  if (group === "exp") {
    document.getElementById("exp-feed").classList.remove("hidden");
    document.getElementById("ctrl-text").classList.add("hidden");
    document.getElementById("exposure-description").textContent =
      "Prohlížejte feed videí po dobu 2 minut.";
  } else {
    document.getElementById("ctrl-text").classList.remove("hidden");
    document.getElementById("exp-feed").classList.add("hidden");
    document.getElementById("exposure-description").textContent =
      "Čtěte prosím text po dobu 2 minut.";
  }

  const t = document.getElementById("exposure-timer");
  const interval = setInterval(() => {
    exposureRemaining--;
    t.textContent = exposureRemaining;
    if (exposureRemaining <= 0) {
      clearInterval(interval);
      show("screen-latency");
      latencyStart = performance.now();
    }
  }, 1000
