<!-- Full index.html with video blur TikTok-like feed and complete JS/HTML -->
<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Experiment – Sociální sítě</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 0;
  text-align: center;
}
.hidden {
  display: none;
}
.container {
  max-width: 700px;
  margin: 20px auto;
  padding: 20px;
  background: white;
  border-radius: 12px;
}
button {
  padding: 12px 24px;
  font-size: 18px;
  border-radius: 12px;
  background: #4c8bf5;
  border: none;
  color: white;
  cursor: pointer;
}
button:hover {
  opacity: 0.9;
}
.video-wrapper {
  position: relative;
  width: 100%;
  height: 70vh;
  overflow: hidden;
  margin-bottom: 25px;
  border-radius: 18px;
  background: black;
}
.video-blur {
  position: absolute;
  width: 120%;
  height: 120%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  object-fit: cover;
  filter: blur(25px) brightness(0.7);
  z-index: 1;
}
.video-main {
  position: relative;
  width: 100%;
  height: 100%;
  object-fit: contain;
  z-index: 2;
}
</style>
</head>
<body>

<!-- ÚVODNÍ OBRAZOVKA -->
<div id="screen-intro" class="container">
  <h2>Experimentální část výzkumu</h2>
  <p>Děkujeme za účast. Po kliknutí na tlačítko budete náhodně zařazeni do jedné ze dvou skupin.</p>
  <button onclick="startExperiment()">Začít</button>
</div>

<!-- EXPOZICE -->
<div id="screen-exposure" class="container hidden">
  <h3 id="exposure-description">Načítám…</h3>
  <p>Zbývající čas: <span id="exposure-timer">120</span> sekund</p>

  <div id="exp-feed" class="feed-container hidden"
       style="height: 90vh; overflow-y: scroll; background:#000; border-radius:18px; padding:0; margin-top:20px;">

    <div class="video-wrapper">
      <video class="video-blur" src="short2.mp4" muted playsinline></video>
      <video class="video-main" src="short2.mp4" muted playsinline autoplay></video>
    </div>

    <div class="video-wrapper">
      <video class="video-blur" src="short3.mp4" muted playsinline></video>
      <video class="video-main" src="short3.mp4" muted playsinline autoplay></video>
    </div>

    <div class="video-wrapper">
      <video class="video-blur" src="short4.mp4" muted playsinline></video>
      <video class="video-main" src="short4.mp4" muted playsinline autoplay></video>
    </div>

    <div class="video-wrapper">
      <video class="video-blur" src="short5.mp4" muted playsinline></video>
      <video class="video-main" src="short5.mp4" muted playsinline autoplay></video>
    </div>

    <div class="video-wrapper">
      <video class="video-blur" src="short6.mp4" muted playsinline></video>
      <video class="video-main" src="short6.mp4" muted playsinline autoplay></video>
    </div>

  </div>

  <div id="ctrl-text" class="hidden" style="text-align:left; padding:20px; background:white; border-radius:12px; margin-top:20px;">
    <h3>Neutrální text</h3>
    <p>
      Toto je neutrální text určený pro kontrolní skupinu. Prosím čtěte jej po dobu dvou minut.
      Jeho účelem je nezpůsobovat žádné emoční reakce ani zvýšenou pozornost. Tento text slouží pouze jako
      kontrolní prvek pro porovnání výsledků experimentální skupiny.
    </p>
  </div>
</div>

<!-- LATENCE -->
<div id="screen-latency" class="container hidden">
  <h3>Klikněte na tlačítko pro zahájení úkolu</h3>
  <button onclick="startTask()">Začít úkol</button>
</div>

<!-- ÚKOL -->
<div id="screen-task" class="container hidden">
  <h3>Úkol</h3>
  <p>Zbývající čas: <span id="task-timer">180</span> sekund</p>
  <div id="task-content" style="margin-top:20px;"></div>
  <button onclick="submitAnswer()">Odeslat odpověď</button>
</div>

<!-- KONEC -->
<div id="screen-end" class="container hidden">
  <h3>Děkujeme za účast</h3>
  <p>Kód respondenta: <b id="code-box"></b></p>
  <p>Skupina: <span id="summary-group"></span></p>
  <p>Latence: <span id="summary-latency"></span> s</p>
  <p>Počet správných odpovědí: <span id="summary-score"></span></p>
  <a id="post-form" href="#" target="_blank">
    <button>Pokračovat</button>
  </a>
</div>

<script>
// ----------------------------------------------------------
// VIDEO BLUR FEED – TikTok style
// ----------------------------------------------------------
document.addEventListener("DOMContentLoaded", () => {
  const videos = document.querySelectorAll("#exp-feed .video-main");

  function pauseAll() {
    videos.forEach(v => v.pause());
  }

  // Autoplay prvního videa
  if (videos.length > 0) {
    videos[0].play().catch(() => {});
  }

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        pauseAll();
        entry.target.play();
      }
    });
  }, { threshold: 0.6 });

  videos.forEach(video => observer.observe(video));

  videos.forEach((video, index) => {
    video.addEventListener("ended", () => {
      const next = videos[index + 1];
      if (next) {
        next.scrollIntoView({ behavior: "smooth", block: "center" });
        setTimeout(() => {
          pauseAll();
          next.play();
        }, 600);
      }
    });
  });
});

// ----------------------------------------------------------
}


const t = document.getElementById("exposure-timer");
const interval = setInterval(() => {
exposureRemaining--;
t.textContent = exposureRemaining;
if (exposureRemaining <= 0) {
clearInterval(interval);
show("screen-latency");
latencyStart = performance.now();
}
}, 1000);
}


function startTask() {
latencyMs = performance.now() - latencyStart;
show("screen-task");
renderTask();


const timer = document.getElementById("task-timer");
const interval = setInterval(() => {
taskRemaining--;
timer.textContent = taskRemaining;
if (taskRemaining <= 0) {
clearInterval(interval);
endTask();
}
}, 1000);
}


function renderTask() {
const c = document.getElementById("task-content");
c.innerHTML = "";
if (currentTask >= TASKS.length) return endTask();
const t = TASKS[currentTask];
c.innerHTML = `<div class="task-item"><p>${t.text}</p><input id="task-answer" type="number"></div>`;
}


function submitAnswer() {
const inp = document.getElementById("task-answer");
if (!inp) return;
const val = parseInt(inp.value);
if (val === TASKS[currentTask].correct) correctCount++;
currentTask++;
if (currentTask < TASKS.length && taskRemaining > 0) renderTask();
else endTask();
}


function endTask() {
participantID = genID(6);
document.getElementById("code-box").textContent = participantID;
document.getElementById("summary-group").textContent = group === "exp" ? "experimentální" : "kontrolní";
document.getElementById("summary-latency").textContent = (latencyMs/1000).toFixed(2);
document.getElementById("summary-score").textContent = correctCount;
document.getElementById("post-form").href = POST_FORM_URL;
sendToSheet();
show("screen-end");
}


function genID(len) {
const c = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
let out = "";
for (let i = 0; i < len; i++) out += c[Math.floor(Math.random()*c.length)];
return out;
}


function sendToSheet() {
fetch(SHEET_URL, {
method: "POST",
mode: "no-cors",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({
participant_id: participantID,
group: group,
latency_seconds: latencyMs/1000,
correct_answers: correctCount
})
});
}
</script>
</body>
</html>
