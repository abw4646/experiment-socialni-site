<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Experiment – Sociální sítě</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
      text-align: center;
    }
.error { color: #b00020; font-size: 14px; margin-top: 6px; }

.hidden { display: none !important; }

    .container {
      max-width: 700px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    button {
      padding: 12px 24px;
      font-size: 18px;
      border-radius: 12px;
      background: #4c8bf5;
      border: none;
      color: white;
      cursor: pointer;
    }

    button:hover { opacity: 0.9; }

    .video-wrapper {
      position: relative;
      width: 100%;
      height: 70vh;
      overflow: hidden;
      margin-bottom: 25px;
      border-radius: 18px;
      background: black;
    }

    .video-blur {
      position: absolute;
      width: 120%;
      height: 120%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      object-fit: cover;
      filter: blur(25px) brightness(0.7);
      z-index: 1;
    }

    .video-main {
      position: relative;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: 2;
    }

    #screen-task h3 { font-size: 28px; margin-bottom: 5px; }
    #task-timer { font-weight: bold; }
    #task-content { margin-top: 40px; text-align: center; font-size: 22px; line-height: 1.4; }

    .task-item p { margin-bottom: 25px; }

    #task-answer {
      width: 200px;
      padding: 12px 14px;
      font-size: 20px;
      border-radius: 10px;
      border: 1px solid #ccc;
      text-align: center;
      margin-bottom: 25px;
    }

    #present-options button {
      margin: 12px;
      padding: 14px 28px;
      font-size: 20px;
      border-radius: 14px;
    }
  </style>
</head>
<body>

  <!-- ÚVOD -->
  <div id="screen-intro" class="container">
    <section style="font-family: Arial, sans-serif; line-height: 1.6; max-width: 700px;">
    <h2 style="color: #2c3e50; margin-bottom: 10px;">Výzkum používání sociálních sítí</h2>

    <p style="font-size: 16px; color: #333;">
        Dobrý den,<br>
        děkuji vám za účast ve výzkumu zaměřeném na používání sociálních sítí, prokrastinaci a rozhodování. 
        Cílem výzkumu je lépe porozumět tomu, jak digitální obsah a online prostředí ovlivňují každodenní rozhodování, 
        schopnost soustředění a tendenci k odkládání úkolů.
    </p>

    <p style="font-size: 16px; color: #333;">
        Získaná data budou využita v diplomové práci a mohou sloužit jako podklad pro doporučení v oblasti managementu,
        marketingu i podpory zdravějšího a efektivnějšího užívání technologií.
    </p>

    <p style="font-size: 16px; color: #333;">
        <strong>Vyplnění zabere přibližně 5–7 minut.</strong>
    </p>

    <p style="font-size: 15px; color: #555; margin-top: 20px;">
        Pokračováním potvrzujete, že je vám více než 18 let a souhlasíte s anonymním zpracováním dat.
    </p>
</section>

<button onclick="show('screen-questionnaire')">Začít</button>
  </div>
<!-- DOTAZNÍK -->
<div id="screen-questionnaire" class="container hidden">
<h3>Krátký dotazník</h3>


<label>Věk:<br>
<input type="number" id="q-age" min="18" max="99" required style="padding:8px; width:200px; margin-top:5px;">
<div id="age-error" class="error hidden">Bohužel se můžete účastnit jen pokud je vám 18 a více.</div>
</label>
<br><br>


<label>Pohlaví:<br>
<select id="q-gender" style="padding:8px; width:220px; margin-top:5px;">
<option value="">Vyberte…</option>
<option value="male">Muž</option>
<option value="female">Žena</option>
<option value="other">Jiné / nechci uvést</option>
</select>
</label>
<br><br>


<label>Kolik minut denně trávíte na sociálních sítích?<br>
<input type="number" id="q-social" min="0" max="900" style="padding:8px; width:200px; margin-top:5px;">
</label>
<br><br>


<label>Jak byste dnes ohodnotil/a svou schopnost soustředění? (1 = velmi nízká, 7 = vysoká)<br>
<input type="number" id="q-focus" min="1" max="7" style="padding:8px; width:200px; margin-top:5px;">
</label>
<br><br>


<label>Jak často odkládáte důležité povinnosti? (1–7)<br>
<input type="number" id="q-procrastination" min="1" max="7" style="padding:8px; width:200px; margin-top:5px;">
</label>
<br><br>


<label>Do jaké míry máte pocit, že používáte sociální sítě více, než byste chtěl/a? (1–7)<br>
<input type="number" id="q-problematic" min="1" max="7" style="padding:8px; width:200px; margin-top:5px;">
</label>
<br><br>


<button onclick="saveQuestionnaire()">Pokračovat</button>
</div>
  
  <!-- EXPOZICE -->
  <div id="screen-exposure" class="container hidden">
    <h3 id="exposure-description">Načítám…</h3>
    <p>Zbývající čas: <span id="exposure-timer">120</span> sekund</p>

    <div id="exp-feed" class="feed-container hidden" style="height: 90vh; overflow-y: scroll; background:#000; border-radius:18px; padding:0; margin-top:20px;">
      <div class="video-wrapper">
        <video class="video-blur" src="short2.mp4" muted playsinline></video>
        <video class="video-main" src="short2.mp4" muted playsinline></video>
      </div>
      <div class="video-wrapper">
        <video class="video-blur" src="short3.mp4" muted playsinline></video>
        <video class="video-main" src="short3.mp4" muted playsinline></video>
      </div>
      <div class="video-wrapper">
        <video class="video-blur" src="short4.mp4" muted playsinline></video>
        <video class="video-main" src="short4.mp4" muted playsinline></video>
      </div>
      <div class="video-wrapper">
        <video class="video-blur" src="short5.mp4" muted playsinline></video>
        <video class="video-main" src="short5.mp4" muted playsinline></video>
      </div>
      <div class="video-wrapper">
        <video class="video-blur" src="short6.mp4" muted playsinline></video>
        <video class="video-main" src="short6.mp4" muted playsinline></video>
      </div>
    </div>

    <div id="ctrl-text" class="hidden" style="text-align:left; padding:20px; background:white; border-radius:12px; margin-top:20px;">
      <h3>Neutrální text</h3>

<p>
  Mosty patří mezi základní technické stavby, které umožňují překonávání různých
  překážek, jako jsou řeky, údolí nebo jiné komunikace. Jejich podoba se může
  výrazně lišit podle toho, jakému účelu slouží a jaké podmínky panují v místě,
  kde jsou umístěny. Základní princip však zůstává stejný: konstrukce má vytvořit
  stabilní plochu, po které se mohou lidé, vozidla nebo jiné prostředky pohybovat
  bez přerušení.
</p>

<p>
  Existuje několik hlavních typů mostních konstrukcí. Jedním z nejstarších je
  nosníkový most, který využívá jednoduchý systém vodorovného nosníku podepřeného
  na obou koncích. Tento typ se často používá tam, kde je třeba překlenout kratší
  vzdálenost. Pro delší rozpětí se využívají obloukové mosty, jejichž tvar umožňuje
  rovnoměrné rozložení zatížení po celé konstrukci. Oblouk je tvořen tak, aby
  přenášel síly do podpěr na obou koncích, což zajišťuje vysokou stabilitu.
</p>

<p>
  Dalším typem jsou visuté mosty, které se vyznačují charakteristickými kabely
  napnutými mezi vysokými pylony. Na těchto kabelech je zavěšena celá mostovka.
  Tento způsob umožňuje překlenout i velmi velké vzdálenosti a je typický pro
  oblasti, kde je potřeba vést komunikaci nad širokou vodní plochou. Podobný
  princip využívají také zavěšené mosty, liší se však způsobem uchycení nosných
  prvků.
</p>

<p>
  Při stavbě mostu se zohledňuje řada faktorů, jako je typ podloží, povětrnostní
  podmínky, zatížení konstrukce nebo způsob budoucí údržby. Materiály mohou být různé —
  od tradičního kamene přes ocel a beton až po moderní kompozitní materiály.
  Volba materiálu ovlivňuje nejen pevnost konstrukce, ale i její životnost a
  nároky na údržbu.
</p>

<p>
  Mosty jsou tedy běžnou součástí infrastruktury a umožňují plynulý pohyb na
  mnoha místech. Ačkoli jejich tvary a konstrukční řešení mohou být různorodé,
  všechny plní stejný praktický účel: propojit dvě oddělené části území
  takovým způsobem, aby byla zajištěna bezpečná a spolehlivá cesta.
</p>

    </div>
  </div>

  <!-- LATENCE -->
  <div id="screen-latency" class="container hidden">
    <h3>Klikněte na tlačítko pro zahájení úkolu</h3>
    <button onclick="startTask()">Začít úkol</button>
  </div>

  <!-- ÚKOL -->
  <div id="screen-task" class="container hidden">
    <h3>Úkol</h3>
    <p>Zbývající čas: <span id="task-timer">180</span> sekund</p>
    <div id="task-content" style="margin-top:20px;"></div>
    <button onclick="submitAnswer()">Odeslat odpověď</button>
  </div>

  <!-- MINI EXPERIMENT -->
  <div id="screen-present" class="container hidden">
    <h3>Mini-experiment – preference odměn</h3>
    <p id="present-question" style="font-size:20px;"></p>
    <p id="present-progress" style="margin-top:8px; color:#666;"></p>
    <div id="present-options" style="margin-top:20px;"></div>
  </div>

  <!-- KONEC -->
  <div id="screen-end" class="container hidden">
    <h3>Děkujeme za účast</h3>
    <p>Kód respondenta: <b id="code-box"></b></p>
    <p>Skupina: <span id="summary-group"></span></p>
    <p>Čas otálení před úkolem: <span id="summary-latency"></span> s</p>
    <p>Správné odpovědi v úkolu: <span id="summary-score"></span></p>
    <p>Voleb „hned teď“ v mini-experimentu: <span id="summary-bias"></span></p>
  </div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbzSO4eItQUiy7P4blTkAdxghcNau2GWrOFdDMH_q01X-_yV8PTS9opgP-jQBvQrB1nB/exec";

const EXPOSURE_SECONDS = 120;
const TASK_SECONDS = 180;

const TASKS = [
{
text: "V obchodě mají balení tužek po 4 kusech. Jana koupila 3 balení. Kolik tužek koupila? (Představ si, že jsou to ULTRA speciální tužky, které údajně zvyšují inteligenci o 0,0001 % — sběratelé šílí.)",
correct: 12
},
{
text: "V krabici je 15 jablek a 4 se zkazí. Kolik jablek zbude? (Ta čtyři zkažená jablka dramaticky odcházejí z krabice, trucují a zakládají vlastní komunitu někde za lednicí.)",
correct: 11
},
{
text: "Tomáš běžel 20 minut a pak šel 15 minut. Jak dlouho byl na cestě? (Tomáš je hrdina — běží, protože honí svoji motivaci… která zase utekla.)",
correct: 35
},
{
text: "Ve třídě je 26 žáků a přijde dalších 18. Kolik je žáků celkem? (Je to extrémně chaotická třída — všichni přichází s nadšením, ale nikdo neví proč.)",
correct: 44
},
{
text: "V balení je 6 lahví a máme 7 balení. Kolik lahví je celkem? (Jsou to magické lahve, které se tváří obyčejně, ale když se nikdo nedívá, šeptají si mezi sebou.)",
correct: 42
}
];

const PRESENT_CHOICES = [
{
  type: "delay",
  prompt: "Jde o volbu mezi okamžitým potěšením a větší budoucí výhodou. Co odpovídá vašemu stylu rozhodování?",
  now: "A) 350 Kč dnes",
  later: "B) 490 Kč za 14 dní"
},
{
  type: "delay",
  prompt: "Po menším úspěchu dostanete možnost vybrat si bonus hned, nebo počkat a získat vyšší částku. Co byste udělali?",
  now: "A) 300 Kč dnes",
  later: "B) 430 Kč za 10 dní"
},
{
  type: "delay",
  prompt: "Menší jistá výhra dnes, nebo větší odměna za delší čekání. Jak silná je vaše trpělivost v této situaci?",
  now: "A) 500 Kč dnes",
  later: "B) 800 Kč za 30 dní"
},
{
  type: "delay",
  prompt: "Kávové dilema: malá radost hned, nebo větší o kousek později?",
  now: "A) 80 Kč dnes",
  later: "B) 150 Kč za 7 dní"
},
{
  type: "risk",
  prompt: "Představte si, že si můžete vzít menší jistou částku, nebo zkusit štěstí v malé loterii s vyšší možnou výhrou. Co zvolíte?",
  now: "A) 300 Kč jistota",
  later: "B) 10% šance na 3000 Kč"
},
{
  type: "risk",
  prompt: "Rozhodujete se mezi zajištěnou odměnou a možností vyhrát více, pokud budete mít štěstí. Co je vám bližší?",
  now: "A) 450 Kč jistota",
  later: "B) 25% šance na 2000 Kč"
},
{
  type: "risk",
  prompt: "Volíte mezi jistým ziskem a loterií s potenciálně vyšším výsledkem. Co byste zvolili?",
  now: "A) 200 Kč jistota",
  later: "B) 50% šance na 500 Kč"
},
{
  type: "loss",
  prompt: "Máte jistou malou ztrátu, nebo risk, že ztratíte více — ale možná také neztratíte nic. Jak byste se rozhodli?",
  now: "A) Jistá ztráta 200 Kč",
  later: "B) 70% šance ztratit 300 Kč / 30% šance neztratit nic"
},
{
  type: "risk",
  prompt: "Jistý příjem, nebo malá šance na výrazně větší výhru — která možnost je vám příjemnější?",
  now: "A) 100 Kč jistota",
  later: "B) 5% šance na 4000 Kč"
},
{
  type: "risk",
  prompt: "Standardní bonus vs. riskantní výkonnostní odměna. Komu byste dali přednost?",
  now: "A) 700 Kč jistota",
  later: "B) 40% šance na 2000 Kč"
}
];


let group = null;
let exposureRemaining = EXPOSURE_SECONDS;
let taskRemaining = TASK_SECONDS;
let latencyStart = null;
let latencyMs = 0;
let currentTask = 0;
let correctCount = 0;
let biasIndex = 0;
let biasImmediate = 0;
let participantID = null;
let presentChoices = []; // <- pole voleb v reálném pořadí


// --- VIDEO LOGIKA ---
document.addEventListener("DOMContentLoaded", () => {
  const feedVideos = document.querySelectorAll("#exp-feed .video-main");

  function pauseAll() {
    feedVideos.forEach(v => v.pause());
  }

  if (feedVideos.length > 0 && "IntersectionObserver" in window) {
    const observer = new IntersectionObserver(entries => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          pauseAll();
          e.target.play().catch(()=>{});
        }
      });
    }, { threshold: 0.6 });

    feedVideos.forEach(v => observer.observe(v));

    feedVideos.forEach((v,i)=>{
      v.addEventListener("ended",()=>{
        const next = feedVideos[i+1];
        if(next){
          next.scrollIntoView({behavior:"smooth",block:"center"});
          setTimeout(()=>{ pauseAll(); next.play().catch(()=>{}); },600);
        }
      });
    });
  }
});

// --- PŘEPÍNÁNÍ OBRAZOVEK ---
function show(id) {
  // schovej úplně všechno, co začíná na screen-
  document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
  // ukaž cílovou obrazovku
  document.getElementById(id).classList.remove('hidden');
  // skoč nahoru
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
  function showQuestionnaire() {
  show('screen-questionnaire');
}


// --- RANDOMIZACE ---
function startExperiment() {
  // náhodná skupina
  group = Math.random() < 0.5 ? "exp" : "ctrl";

  // === TEST režim: když je expozice 0–1 s, přeskoč ji rovnou ===
  if (EXPOSURE_SECONDS < 1) {
    // jen pro konzistenci nastav popisek (nebude vlastně vidět)
    document.getElementById("exposure-description").textContent =
      group === "exp" ? "Prohlížejte feed videí…" : "Čtěte neutrální text…";

    // rovnou jdi na měření latence
    show("screen-latency");
    latencyStart = performance.now();
    return;
  }

  // === BĚŽNÝ režim: normálně zobraz expozici ===
  show("screen-exposure");

  if (group === "exp") {
    document.getElementById("exp-feed").classList.remove("hidden");
    document.getElementById("ctrl-text").classList.add("hidden");
    document.getElementById("exposure-description").textContent =
      "Prohlížejte prosím feed videí po dobu 2 minut.";
  } else {
    document.getElementById("ctrl-text").classList.remove("hidden");
    document.getElementById("exp-feed").classList.add("hidden");
    document.getElementById("exposure-description").textContent =
      "Čtěte prosím text po dobu 2 minut.";
  }

  const t = document.getElementById("exposure-timer");
  exposureRemaining = EXPOSURE_SECONDS;
  t.textContent = exposureRemaining;

  const interval = setInterval(() => {
    exposureRemaining--;
    t.textContent = exposureRemaining;

    if (exposureRemaining <= 0) {
      clearInterval(interval);
      show("screen-latency");
      latencyStart = performance.now();
    }
  }, 1000);
}


// --- START ÚKOLU ---
function startTask() {
  latencyMs = performance.now() - latencyStart;
  show("screen-task");

  taskRemaining = TASK_SECONDS;
  currentTask = 0;
  correctCount = 0;

  const timer = document.getElementById("task-timer");
  timer.textContent = taskRemaining;

  renderTask();

  const interval = setInterval(()=>{
    taskRemaining--;
    timer.textContent = taskRemaining;

    if (taskRemaining <= 0) {
      clearInterval(interval);
      endTask();
    }
  },1000);
}

// --- MATEMATICKÝ ÚKOL ---
function renderTask() {
  const c = document.getElementById("task-content");
  c.innerHTML = "";

  if (currentTask >= TASKS.length) {
    endTask();
    return;
  }

  const t = TASKS[currentTask];
  c.innerHTML = `<div class="task-item"><p>${t.text}</p><input id="task-answer" type="number"></div>`;
  const inp = document.getElementById("task-answer");
  if (inp) inp.focus();
}

function submitAnswer() {
  const inp = document.getElementById("task-answer");
  if (!inp) return;

  const val = parseInt(inp.value,10);
  const t = TASKS[currentTask];

  if (!isNaN(val) && val === t.correct) correctCount++;

  currentTask++;
  if (currentTask < TASKS.length && taskRemaining > 0) renderTask();
  else endTask();
}

// --- PRESENT BIAS ---
function endTask() {
  show("screen-present");
  biasIndex = 0;
biasImmediate = 0;
presentChoices = [];
  renderPresentChoice();
}

function renderPresentChoice() {
  const total = PRESENT_CHOICES.length;

  if (biasIndex >= total) {
    finishAll();
    return;
  }

  const ch = PRESENT_CHOICES[biasIndex];
  document.getElementById("present-question").textContent = ch.prompt;
  document.getElementById("present-progress").textContent = `Volba ${biasIndex+1} z ${total}`;

  document.getElementById("present-options").innerHTML = `
    <button onclick="chooseImmediate()">${ch.now}</button>
    <button onclick="chooseDelayed()">${ch.later}</button>
  `;
}

function chooseImmediate() {
  presentChoices.push("now");
biasImmediate++;
biasIndex++;
if (biasIndex >= PRESENT_CHOICES.length) return finishAll();
renderPresentChoice();
  }

function chooseDelayed() {
  presentChoices.push("later");
biasIndex++;
if (biasIndex >= PRESENT_CHOICES.length) return finishAll();
renderPresentChoice();
}


// --- ZÁVĚR + ODESLÁNÍ ---
function finishAll() {
  participantID = genID(6);

  document.getElementById("code-box").textContent = participantID;
  document.getElementById("summary-group").textContent = group === "exp" ? "experimentální" : "kontrolní";
  document.getElementById("summary-latency").textContent = (latencyMs/1000).toFixed(2);
  document.getElementById("summary-score").textContent = correctCount;
document.getElementById("summary-bias").textContent = `${biasImmediate} / ${PRESENT_CHOICES.length}`;

  sendToSheet();
  show("screen-end");
}

function genID(len) {
  const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  let out = "";
  for (let i=0;i<len;i++) out += chars[Math.floor(Math.random()*chars.length)];
  return out;
}

function sendToSheet() {
const payload = {
participant_id: participantID,
group: group,
latency_seconds: latencyMs / 1000,
correct_answers: correctCount,
present_bias_score: biasImmediate,
present_bias_raw_choices: presentChoices,
age: window.formAge || null,
gender: window.formGender || null,
social_media_minutes: window.formSocialMedia || null,
subjective_focus: window.formFocus || null,
procrastination_score: window.formProcrastination || null,
problematic_use_score: window.formProblematicUse || null
};


fetch(SHEET_URL, {
  method: "POST",
  mode: "no-cors", // kvůli CORS bez preflightu
  headers: { "Content-Type": "text/plain;charset=utf-8" }, // simple request
  body: JSON.stringify(payload),
  keepalive: true // když uživatel rychle zavře stránku
})
.then(() => console.log("Odesláno (no-cors)"))
.catch(e => console.error("Chyba při odesílání: ", e));

}
function saveQuestionnaire() {
  // pomocná na čísla
  const toNum = v => {
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  };

  // načti hodnoty
  const ageVal = toNum(document.getElementById("q-age").value);
  const genderVal = document.getElementById("q-gender").value || null;
  const socialVal = toNum(document.getElementById("q-social").value);
  const focusVal = toNum(document.getElementById("q-focus").value);
  const procrastVal = toNum(document.getElementById("q-procrastination").value);
  const problemVal = toNum(document.getElementById("q-problematic").value);

  // 18+ brána
  const ageErr = document.getElementById("age-error");
  if (!ageVal || ageVal < 18) {
    ageErr.classList.remove("hidden");
    // přejdi pohledem na pole věku (pro mobily)
    document.getElementById("q-age").scrollIntoView({ behavior: "smooth", block: "center" });
    return; // NEPOKRAČUJ
  } else {
    ageErr.classList.add("hidden");
  }

  // ulož do window* pro odeslání
  window.formAge = ageVal;
  window.formGender = genderVal;
  window.formSocialMedia = socialVal;
  window.formFocus = focusVal;
  window.formProcrastination = procrastVal;
  window.formProblematicUse = problemVal;

  // schovej dotazník a pokračuj do expozice/latence
  show("screen-exposure");
  startExperiment();
}




window.startExperiment = startExperiment;
window.saveQuestionnaire = saveQuestionnaire;
window.startTask = startTask;
window.submitAnswer = submitAnswer;
window.chooseImmediate = chooseImmediate;
window.chooseDelayed = chooseDelayed;
  window.showQuestionnaire = showQuestionnaire; // aby byla globálně dostupná pro onclick

</script>
</body>
</html>
