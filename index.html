<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Experiment – Sociální sítě (Finální verze)</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 0;
  text-align: center;
}
.hidden { display: none; }
.container {
  max-width: 700px;
  margin: 20px auto;
  padding: 20px;
  background: white;
  border-radius: 12px;
}
button {
  padding: 12px 24px;
  font-size: 18px;
  border-radius: 12px;
  background: #4c8bf5;
  border: none;
  color: white;
  cursor: pointer;
}
button:hover { opacity: 0.9; }
.video-wrapper {
  position: relative;
  width: 100%;
  height: 70vh;
  overflow: hidden;
  margin-bottom: 25px;
  border-radius: 18px;
  background: black;
}
.video-blur {
  position: absolute;
  width: 120%;
  height: 120%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  object-fit: cover;
  filter: blur(25px) brightness(0.7);
  z-index: 1;
}
.video-main {
  position: relative;
  width: 100%;
  height: 100%;
  object-fit: contain;
  z-index: 2;
}
#present-options button {
  margin: 12px;
  padding: 14px 28px;
  font-size: 20px;
  border-radius: 14px;
}
</style>
</head>
<body>

<div id="screen-intro" class="container">
  <h2>Experimentální část výzkumu</h2>
  <p>Děkujeme za účast. Po kliknutí na tlačítko budete náhodně zařazeni do jedné ze dvou skupin.</p>
  <button onclick="startExperiment()">Začít</button>
</div>

<div id="screen-exposure" class="container hidden">
  <h3 id="exposure-description">Načítám…</h3>
  <p>Zbývající čas: <span id="exposure-timer">120</span> sekund</span></p>

  <div id="exp-feed" class="hidden" style="height:90vh; overflow-y:scroll; background:#000; border-radius:18px; padding:0; margin-top:20px;"></div>

  <div id="ctrl-text" class="hidden" style="text-align:left; padding:20px; background:white; border-radius:12px; margin-top:20px;">
    <h3>Neutrální text</h3>
    <p>Prosím čtěte následující text po dobu dvou minut...</p>
  </div>
</div>

<div id="screen-latency" class="container hidden">
  <h3>Klikněte na tlačítko pro zahájení úkolu</h3>
  <button onclick="startTask()">Začít úkol</button>
</div>

<div id="screen-task" class="container hidden">
  <h3>Úkol</h3>
  <p>Zbývající čas: <span id="task-timer">180</span> sekund</p>
  <div id="task-content" style="margin-top:20px;"></div>
  <button onclick="submitAnswer()">Odeslat odpověď</button>
</div>

<div id="screen-present" class="container hidden">
  <h3>Mini‑experiment – preference odměn</h3>
  <p>Vyberte možnost, která je vám bližší.</p>
  <div id="present-options" style="margin-top:20px;"></div>
</div>

<div id="screen-end" class="container hidden">
  <h3>Děkujeme za účast</h3>
  <p>Kód respondenta: <b id="code-box"></b></p>
  <p>Skupina: <span id="summary-group"></span></p>
  <p>Latence: <span id="summary-latency"></span> s</p>
  <p>Počet správných odpovědí: <span id="summary-score"></span></p>
  <p>Present bias skóre (počet voleb „dnes“): <b id="summary-bias"></b></p>
  <a id="post-form" href="#" target="_blank"><button>Pokračovat</button></a>
</div>

<script>
const POST_FORM_URL = "https://docs.google.com/forms/.....";
const SHEET_URL = "https://script.google.com/macros/s/.../exec";

const EXPOSURE_SECONDS = 120;
const TASK_SECONDS = 180;

const PRESENT_CHOICES = [
  { now: "200 Kč dnes", later: "260 Kč za 7 dní" },
  { now: "300 Kč dnes", later: "380 Kč za 14 dní" },
  { now: "150 Kč dnes", later: "230 Kč za  7 dní" },
  { now: "500 Kč dnes", later: "710 Kč za 30 dní" },
  { now: "80 Kč dnes",  later: "140 Kč za  7 dní" }
];

const TASKS = [
  { text: "V obchodě mají balení tužek po 4 kusech. Jana koupila 3 balení. Kolik tužek koupila?", correct: 12 },
  { text: "V krabici je 15 jablek, 4 se zkazí. Kolik jablek zbude?", correct: 11 },
  { text: "Tomáš běžel 20 min a pak šel 15 min. Jak dlouho byl na cestě?", correct: 35 },
  { text: "26 žáků + 18 žáků = ?", correct: 44 },
  { text: "6 lahví v balení × 7 balení = ?", correct: 42 }
];

let group = null;
let exposureRemaining = EXPOSURE_SECONDS;
let taskRemaining = TASK_SECONDS;
let latencyStart = null;
let latencyMs = null;
let currentTask = 0;
let correctCount = 0;
let biasIndex = 0;
let biasImmediate = 0;
let participantID = null;

function show(id){
  ["screen-intro","screen-exposure","screen-latency","screen-task","screen-present","screen-end"]
    .forEach(s=>document.getElementById(s).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function startExperiment(){
  group = Math.random()<0.5?"exp":"ctrl";
  show("screen-exposure");

  if(group==="exp"){ document.getElementById("exp-feed").classList.remove("hidden"); }
  else{ document.getElementById("ctrl-text").classList.remove("hidden"); }

  const t=document.getElementById("exposure-timer");
  const interval=setInterval(()=>{
    exposureRemaining--; t.textContent=exposureRemaining;
    if(exposureRemaining<=0){ clearInterval(interval); show("screen-latency"); latencyStart=performance.now(); }
  },1000);
}

function startTask(){
  latencyMs=performance.now()-latencyStart;
  show("screen-task");
  renderTask();

  const timer=document.getElementById("task-timer");
  const interval=setInterval(()=>{
    taskRemaining--; timer.textContent=taskRemaining;
    if(taskRemaining<=0){ clearInterval(interval); endTask(); }
  },1000);
}

function renderTask(){
  const c=document.getElementById("task-content");
  if(currentTask>=TASKS.length) return endTask();
  c.innerHTML=`<p>${TASKS[currentTask].text}</p>
               <input id="task-answer" type="number" style="font-size:20px; padding:10px;">`;
}

function submitAnswer(){
  const val=parseInt(document.getElementById("task-answer").value);
  if(val===TASKS[currentTask].correct) correctCount++;
  currentTask++;
  if(currentTask<TASKS.length && taskRemaining>0) renderTask(); else endTask();
}

function endTask(){ show("screen-present"); renderPresent(); }

function renderPresent(){
  if(biasIndex>=PRESENT_CHOICES.length) return finishAll();
  const c=document.getElementById("present-options");
  const ch=PRESENT_CHOICES[biasIndex];
  c.innerHTML = `
    <button onclick="chooseImmediate()">${ch.now}</button>
    <button onclick="chooseDelayed()">${ch.later}</button>
  `;
}

function chooseImmediate(){ biasImmediate++; biasIndex++; renderPresent(); }
function chooseDelayed(){ biasIndex++; renderPresent(); }

function finishAll(){
  participantID = genID(6);
  document.getElementById("code-box").textContent = participantID;
  document.getElementById("summary-group").textContent = group==="exp"?"experimentální":"kontrolní";
  document.getElementById("summary-latency").textContent = (latencyMs/1000).toFixed(2);
  document.getElement

  document.getElementById("summary-score").textContent = correctCount;
  document.getElementById("summary-bias").textContent = biasImmediate + " / " + PRESENT_CHOICES.length;

  document.getElementById("post-form").href = POST_FORM_URL;

  sendToSheet();
  show("screen-end");
}

// ----------------------------------------------------------
// ODESLÁNÍ DAT DO GOOGLE SHEETS
// ----------------------------------------------------------

function sendToSheet(){
  fetch(SHEET_URL,{
    method:"POST",
    mode:"no-cors",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      participant_id:participantID,
      group:group,
      latency_seconds:latencyMs/1000,
      correct_answers:correctCount,
      present_bias_score: biasImmediate
    })
  });
}

</script>
</body>
</html>
